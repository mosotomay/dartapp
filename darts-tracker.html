<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Darts Tracker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0d0d0d;
      --surface: #1a1a1a;
      --neon: #00ff88;
      --neon-dim: #00cc6a;
      --text: #e0e0e0;
      --muted: #888;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 12px;
      padding-bottom: 24px;
    }
    h1 { font-size: 1.5rem; color: var(--neon); margin-bottom: 8px; }
    h2 { font-size: 1.2rem; color: var(--neon); margin: 16px 0 8px; }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .tab {
      flex: 1;
      min-width: 80px;
      padding: 14px 16px;
      font-size: 1rem;
      font-weight: 600;
      border: 2px solid var(--neon);
      background: var(--surface);
      color: var(--neon);
      border-radius: 12px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .tab.active { background: var(--neon); color: var(--bg); }
    .panel { display: none; }
    .panel.active { display: block; }
    .card {
      background: var(--surface);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid rgba(0,255,136,0.2);
    }
    .row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .row:last-child { margin-bottom: 0; }
    label { min-width: 80px; color: var(--muted); font-size: 0.9rem; }
    select, input[type="number"] {
      flex: 1;
      min-width: 100px;
      padding: 14px;
      font-size: 1.1rem;
      background: var(--bg);
      border: 2px solid var(--neon-dim);
      color: var(--text);
      border-radius: 10px;
    }
    .btn {
      display: inline-block;
      padding: 16px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: transform 0.1s, box-shadow 0.1s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary {
      background: var(--neon);
      color: var(--bg);
      width: 100%;
      margin-top: 8px;
    }
    .btn-secondary {
      background: var(--surface);
      color: var(--neon);
      border: 2px solid var(--neon);
    }
    .numpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 16px 0;
    }
    .numpad .btn {
      padding: 20px;
      font-size: 1.3rem;
    }
    .score-display {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--neon);
      text-align: center;
      padding: 16px;
      margin-bottom: 8px;
    }
    .player-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg);
      border-radius: 10px;
      margin-bottom: 8px;
    }
    .player-row.current { box-shadow: 0 0 0 2px var(--neon); }
    .player-name { font-weight: 600; }
    .player-score { font-size: 1.5rem; color: var(--neon); }
    .checkout-box {
      background: rgba(0,255,136,0.1);
      border: 1px solid var(--neon-dim);
      border-radius: 10px;
      padding: 12px;
      margin-top: 12px;
      font-size: 0.95rem;
      color: var(--neon);
    }
    .checkout-box strong { display: block; margin-bottom: 4px; }
    .bust { color: #ff4444; font-weight: 600; margin-top: 8px; }
    .history-list { list-style: none; }
    .history-list li {
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      font-size: 0.95rem;
    }
    .history-list li:last-child { border-bottom: none; }
    .stat-line { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.06); }
    .stat-line:last-child { border-bottom: none; }
    .muted { color: var(--muted); font-size: 0.85rem; }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ Darts Tracker</h1>
  <div class="tabs">
    <button class="tab active" data-panel="home">Play</button>
    <button class="tab" data-panel="stats">Modog Stats</button>
    <button class="tab" data-panel="history">History</button>
  </div>

  <div id="home" class="panel active">
    <div class="card">
      <h2>New game</h2>
      <div class="row">
        <label>Mode</label>
        <select id="mode">
          <option value="301">301 Double-out</option>
          <option value="501">501 Double-out</option>
          <option value="cricket">Cricket</option>
        </select>
      </div>
      <div class="row" id="x01Only">
        <label>Starting score</label>
        <input type="number" id="startScore" value="501" min="101" max="1001" step="100">
      </div>
      <button class="btn btn-primary" id="startGame">Start game</button>
    </div>
    <div id="gameArea" style="display:none;">
      <div class="card">
        <div id="playersContainer"></div>
        <div id="roundInfo" class="muted"></div>
        <div id="x01UI">
          <div class="score-display" id="currentScore">0</div>
          <div class="numpad" id="numpad"></div>
          <button class="btn btn-secondary" id="btnBust">Bust</button>
          <div class="checkout-box" id="checkoutBox"></div>
        </div>
        <div id="cricketUI" style="display:none;">
          <div id="cricketBoard"></div>
          <div class="numpad" id="cricketNumpad"></div>
        </div>
        <button class="btn btn-primary" id="endGame" style="margin-top:12px;">End game</button>
      </div>
    </div>
  </div>

  <div id="stats" class="panel">
    <div class="card">
      <h2>Modog â€“ X01</h2>
      <div id="modogX01Stats" class="stat-line">No X01 games yet.</div>
    </div>
    <div class="card">
      <h2>Modog â€“ Cricket</h2>
      <div id="modogCricketStats" class="stat-line">No Cricket games yet.</div>
    </div>
  </div>

  <div id="history" class="panel">
    <div class="card">
      <h2>Past games</h2>
      <ul class="history-list" id="historyList"></ul>
    </div>
  </div>

  <script>
(function() {
  const PROFILE = 'modog';
  const STORAGE_KEY = 'darts_tracker_data';

  function getData() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : { history: [], modogStats: { x01: [], cricket: [] } };
    } catch (e) {
      return { history: [], modogStats: { x01: [], cricket: [] } };
    }
  }

  function saveData(data) {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {}
  }

  const CHECKOUTS = {
    170: 'T20 T20 Bull', 167: 'T20 T19 Bull', 164: 'T20 T18 Bull', 161: 'T20 T17 Bull',
    160: 'T20 T20 D20', 158: 'T20 T20 D19', 157: 'T20 T19 D20', 156: 'T20 T20 D18',
    155: 'T20 T19 D19', 154: 'T20 T18 D20', 153: 'T20 T19 D18', 152: 'T20 T20 D16',
    151: 'T20 T17 D20', 150: 'T20 T18 D18', 149: 'T20 T19 D16', 148: 'T20 T20 D14',
    147: 'T20 T17 D18', 146: 'T20 T18 D16', 145: 'T20 T15 D20', 144: 'T20 T20 D12',
    143: 'T20 T17 D16', 142: 'T20 T14 D20', 141: 'T20 T19 D12', 140: 'T20 T20 D10',
    139: 'T19 T14 D20', 138: 'T20 T18 D12', 137: 'T20 T19 D10', 136: 'T20 T20 D8',
    135: 'T20 T15 D15', 134: 'T20 T14 D16', 133: 'T20 T19 D8', 132: 'T20 T20 D6',
    131: 'T20 T13 D16', 130: 'T20 T20 D5', 129: 'T19 T20 D6', 128: 'T18 T14 D16',
    127: 'T20 T17 D8', 126: 'T19 T19 D6', 125: 'Bull T15 D20', 124: 'T20 T14 D11',
    123: 'T19 T16 D9', 122: 'T18 T20 D4', 121: 'T20 T11 D14', 120: 'T20 S20 D20',
    119: 'T19 T12 D11', 118: 'T20 S18 D20', 117: 'T20 S17 D20', 116: 'T20 S16 D20',
    115: 'T20 S15 D20', 114: 'T20 S14 D20', 113: 'T20 S13 D20', 112: 'T20 S12 D20',
    111: 'T20 S11 D20', 110: 'T20 S10 D20', 109: 'T20 S9 D20', 108: 'T20 S8 D20',
    107: 'T20 S7 D20', 106: 'T20 S6 D20', 105: 'T20 S5 D20', 104: 'T20 S4 D20',
    103: 'T20 S3 D20', 102: 'T20 S2 D20', 101: 'T20 S1 D20', 100: 'T20 D20',
    99: 'T19 S10 D16', 98: 'T20 D19', 97: 'T19 D20', 96: 'T20 D18', 95: 'T19 D19',
    94: 'T18 D20', 93: 'T19 D18', 92: 'T20 D16', 91: 'T17 D20', 90: 'T20 D15',
    89: 'T19 D16', 88: 'T20 D14', 87: 'T17 D18', 86: 'T18 D16', 85: 'T15 D20',
    84: 'T20 D12', 83: 'T17 D16', 82: 'T14 D20', 81: 'T19 D12', 80: 'T20 D10',
    79: 'T19 D11', 78: 'T18 D12', 77: 'T19 D10', 76: 'T20 D8', 75: 'T17 D12',
    74: 'T14 D16', 73: 'T19 D8', 72: 'T20 D6', 71: 'T13 D16', 70: 'T18 D8',
    69: 'T19 D6', 68: 'T20 D4', 67: 'T17 D8', 66: 'T10 D18', 65: 'T15 D10',
    64: 'T16 D8', 63: 'T13 D12', 62: 'T10 D16', 61: 'T15 D8', 60: 'S20 D20',
    59: 'S19 D20', 58: 'S18 D20', 57: 'T19 D0', 56: 'T16 D4', 55: 'S15 D20',
    54: 'S14 D20', 53: 'S13 D20', 52: 'S12 D20', 51: 'S11 D20', 50: 'Bull',
    49: 'S9 D20', 48: 'S16 D16', 47: 'S7 D20', 46: 'S6 D20', 45: 'S5 D20',
    44: 'S4 D20', 43: 'S3 D20', 42: 'S10 D16', 41: 'S9 D16', 40: 'D20',
    39: 'S7 D16', 38: 'D19', 37: 'S5 D16', 36: 'D18', 35: 'S3 D16', 34: 'D17',
    33: 'S1 D16', 32: 'D16', 31: 'S15 D8', 30: 'D15', 29: 'S13 D8', 28: 'D14',
    27: 'S11 D8', 26: 'D13', 25: 'S9 D8', 24: 'D12', 23: 'S7 D8', 22: 'D11',
    21: 'S5 D8', 20: 'D10', 19: 'S3 D8', 18: 'D9', 17: 'S1 D8', 16: 'D8',
    15: 'S7 D4', 14: 'D7', 13: 'S5 D4', 12: 'D6', 11: 'S3 D4', 10: 'D5',
    9: 'S1 D4', 8: 'D4', 7: 'S3 D2', 6: 'D3', 5: 'S1 D2', 4: 'D2', 3: 'S1 D1', 2: 'D1'
  };

  let state = {
    mode: '501',
    startScore: 501,
    players: [{ name: PROFILE, score: 501, cricket: null }],
    currentPlayer: 0,
    round: 1,
    turnTotal: 0,
    dartsThisLeg: 0,
    cricketRounds: []
  };

  function showPanel(name) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    const panel = document.getElementById(name);
    const tab = document.querySelector('.tab[data-panel="' + name + '"]');
    if (panel) panel.classList.add('active');
    if (tab) tab.classList.add('active');
    if (name === 'stats') renderModogStats();
    if (name === 'history') renderHistory();
  }

  document.querySelectorAll('.tab').forEach(t => {
    t.addEventListener('click', () => showPanel(t.dataset.panel));
  });

  const modeEl = document.getElementById('mode');
  const startScoreEl = document.getElementById('startScore');
  const x01Only = document.getElementById('x01Only');
  modeEl.addEventListener('change', () => {
    const isCricket = modeEl.value === 'cricket';
    x01Only.style.display = isCricket ? 'none' : 'flex';
    if (!isCricket) startScoreEl.value = modeEl.value;
  });

  function buildNumpad() {
    const pad = document.getElementById('numpad');
    pad.innerHTML = '';
    const scores = [60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3,'Bust'];
    scores.forEach(s => {
      const b = document.createElement('button');
      b.className = 'btn btn-secondary';
      b.textContent = s === 'Bust' ? 'Bust' : s;
      b.addEventListener('click', () => enterScore(Number(s) || 0, s === 'Bust'));
      pad.appendChild(b);
    });
  }

  function enterScore(points, isBust) {
    if (state.mode === 'cricket') return;
    const p = state.players[state.currentPlayer];
    if (isBust) {
      p.score = p.score + state.turnTotal;
      state.turnTotal = 0;
      state.dartsThisLeg += 3;
      nextTurn();
      renderGame();
      return;
    }
    state.turnTotal += points;
    const newScore = p.score - state.turnTotal;
    if (newScore < 0) {
      p.score = p.score;
      state.turnTotal = 0;
      state.dartsThisLeg += 3;
      nextTurn();
      renderGame();
      return;
    }
    if (newScore === 0) {
      const mustDouble = state.startScore <= 301 || state.startScore === 501;
      if (mustDouble && (points < 2 || points % 2 !== 0)) {
        p.score = p.score;
        state.turnTotal = 0;
        state.dartsThisLeg += 3;
        nextTurn();
        renderGame();
        return;
      }
      finishLeg();
      return;
    }
    document.getElementById('currentScore').textContent = newScore;
    updateCheckout(newScore);
  }

  function nextTurn() {
    state.turnTotal = 0;
    state.currentPlayer = (state.currentPlayer + 1) % state.players.length;
    if (state.currentPlayer === 0) state.round++;
    renderGame();
  }

  function finishLeg() {
    state.dartsThisLeg += 3;
    const data = getData();
    const entry = {
      id: Date.now(),
      mode: state.mode,
      startScore: state.startScore,
      winner: state.players[state.currentPlayer].name,
      dartsToFinish: state.dartsThisLeg,
      date: new Date().toISOString()
    };
    data.history.push(entry);
    if (state.players[state.currentPlayer].name === PROFILE) {
      data.modogStats.x01.push({ dartsToFinish: state.dartsThisLeg, date: entry.date });
    }
    saveData(data);
    alert(state.players[state.currentPlayer].name + ' wins! Darts to finish: ' + state.dartsThisLeg);
    document.getElementById('gameArea').style.display = 'none';
    buildNumpad();
  }

  function updateCheckout(score) {
    const box = document.getElementById('checkoutBox');
    if (score > 170 || score < 2) {
      box.innerHTML = '';
      return;
    }
    const suggestion = CHECKOUTS[score] || 'â€”';
    box.innerHTML = '<strong>Checkout ' + score + '</strong>' + suggestion;
  }

  function renderGame() {
    const p = state.players[state.currentPlayer];
    document.querySelectorAll('.player-row').forEach((row, i) => {
      row.classList.toggle('current', i === state.currentPlayer);
      row.querySelector('.player-score').textContent = state.players[i].score;
    });
    document.getElementById('currentScore').textContent = p.score - state.turnTotal;
    document.getElementById('roundInfo').textContent = 'Round ' + state.round + ' Â· ' + p.name;
    updateCheckout(Math.max(0, p.score - state.turnTotal));
  }

  document.getElementById('btnBust').addEventListener('click', () => enterScore(0, true));

  document.getElementById('startGame').addEventListener('click', () => {
    state.mode = modeEl.value;
    state.startScore = state.mode === 'cricket' ? 0 : parseInt(startScoreEl.value, 10);
    state.players = [{ name: PROFILE, score: state.mode === 'cricket' ? 0 : state.startScore, cricket: null }];
    state.currentPlayer = 0;
    state.round = 1;
    state.turnTotal = 0;
    state.dartsThisLeg = 0;
    state.cricketRounds = [];

    const isCricket = state.mode === 'cricket';
    document.getElementById('x01UI').style.display = isCricket ? 'none' : 'block';
    document.getElementById('cricketUI').style.display = isCricket ? 'block' : 'none';

    const container = document.getElementById('playersContainer');
    container.innerHTML = state.players.map((pl, i) =>
      '<div class="player-row' + (i === 0 ? ' current' : '') + '"><span class="player-name">' + pl.name + '</span><span class="player-score">' + (isCricket ? 'â€”' : pl.score) + '</span></div>'
    ).join('');

    if (!isCricket) {
      buildNumpad();
      renderGame();
    } else {
      renderCricket();
    }
    document.getElementById('gameArea').style.display = 'block';
  });

  const CRICKET_NUMBERS = [20,19,18,17,16,15,25];
  function renderCricket() {
    const board = document.getElementById('cricketBoard');
    const pad = document.getElementById('cricketNumpad');
    board.innerHTML = '<div class="row" style="margin-bottom:8px"><strong>Number</strong><strong>Modog</strong></div>';
    CRICKET_NUMBERS.forEach(n => {
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = '<span>' + (n === 25 ? 'Bull' : n) + '</span><span id="cricket-' + n + '">0</span>';
      board.appendChild(row);
    });
    if (!state.players[0].cricket) state.players[0].cricket = Object.fromEntries(CRICKET_NUMBERS.map(n => [n, 0]));
    pad.innerHTML = '';
    CRICKET_NUMBERS.forEach(n => {
      [1,2,3].forEach(m => {
        const b = document.createElement('button');
        b.className = 'btn btn-secondary';
        b.textContent = (n === 25 ? 'B' : n) + '/' + m;
        b.addEventListener('click', () => cricketMark(n, m));
        pad.appendChild(b);
      });
    });
  }

  function cricketMark(num, marks) {
    const p = state.players[state.currentPlayer];
    if (!p.cricket) p.cricket = Object.fromEntries(CRICKET_NUMBERS.map(n => [n, 0]));
    p.cricket[num] = Math.min(3, (p.cricket[num] || 0) + marks);
    document.getElementById('cricket-' + num).textContent = p.cricket[num];
    const totalMarks = CRICKET_NUMBERS.reduce((s, n) => s + (p.cricket[n] || 0), 0);
    state.cricketRounds.push({ player: state.currentPlayer, marks: marks });
    state.currentPlayer = (state.currentPlayer + 1) % state.players.length;
    if (state.currentPlayer === 0) state.round++;
    const allClosed = CRICKET_NUMBERS.every(n => (p.cricket[n] || 0) >= 3);
    if (allClosed) {
      const data = getData();
      const totalThrows = state.cricketRounds.length * 3;
      const roundsPlayed = state.round;
      const mpr = totalMarks / (roundsPlayed || 1);
      data.history.push({
        id: Date.now(),
        mode: 'cricket',
        winner: PROFILE,
        mpr: Math.round(mpr * 100) / 100,
        date: new Date().toISOString()
      });
      data.modogStats.cricket.push({ mpr: Math.round(mpr * 100) / 100, date: new Date().toISOString() });
      saveData(data);
      alert('Modog wins Cricket! MPR: ' + Math.round(mpr * 100) / 100);
      document.getElementById('gameArea').style.display = 'none';
    }
  }

  document.getElementById('endGame').addEventListener('click', () => {
    if (confirm('End game without saving?')) document.getElementById('gameArea').style.display = 'none';
  });

  function renderModogStats() {
    const data = getData();
    const x01 = data.modogStats.x01 || [];
    const cricket = data.modogStats.cricket || [];
    const avgDarts = x01.length ? (x01.reduce((s, g) => s + g.dartsToFinish, 0) / x01.length).toFixed(1) : 'â€”';
    const avgMpr = cricket.length ? (cricket.reduce((s, g) => s + g.mpr, 0) / cricket.length).toFixed(2) : 'â€”';
    document.getElementById('modogX01Stats').innerHTML = 'Games: ' + x01.length + ' Â· Avg Darts to Finish: ' + avgDarts;
    document.getElementById('modogCricketStats').innerHTML = 'Games: ' + cricket.length + ' Â· Avg MPR: ' + avgMpr;
  }

  function renderHistory() {
    const data = getData();
    const list = document.getElementById('historyList');
    const items = (data.history || []).slice().reverse().slice(0, 50);
    list.innerHTML = items.length ? items.map(h => {
      const d = new Date(h.date);
      const dateStr = d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      if (h.mode === 'cricket') return '<li>' + dateStr + ' â€“ Cricket â€“ ' + (h.winner || 'Modog') + ' (MPR ' + (h.mpr || 'â€”') + ')</li>';
      return '<li>' + dateStr + ' â€“ ' + (h.startScore || 501) + ' â€“ ' + (h.winner || 'Modog') + ' â€“ ' + (h.dartsToFinish || 'â€”') + ' darts</li>';
    }).join('') : '<li class="muted">No games yet.</li>';
  }

  renderHistory();
})();
  </script>
</body>
</html>
